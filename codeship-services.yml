fedoradata:
  build: ./.docker/development/fedora/data/
  cached: true

fpmtestrunner:
  build:
    dockerfile_path: "Dockerfile.runner"
  #encrypted_env_file: ./.codeship/dockerenv.encrypted
  environment:
    APP_ENVIRONMENT: "testing"
    XDEBUG_CONFIG: "idekey=fez"
    PHP_IDE_CONFIG: "serverName=dev-fez.library.uq.edu.au"
    JAVA_HOME: "/usr/lib/jvm/jre"
    JHOVE_HOME: "/usr/local/jhove"
    JET_RUN: "true"
  links:
    - fez
    - fezdb
    - fedora
    - fedoradb
    - selenium
  volumes_from:
    - fezcode
    - fedoradata
    - cache
  cached: true

selenium:
  image: selenium/standalone-chrome-debug:2.53.0
  environment:
    - JAVA_OPTS=-Dselenium.LOGGER.level=WARNING
  ports:
    - "5902:5900"
  links:
    - fez
    - fedora
  cached: true

fez:
  build:
    image: codeship_fez
    dockerfile_path: Dockerfile
    path: ./.docker/development/backend/nginx/
  links:
    - fpm
  volumes_from:
    - fezcode
    - fedoradata
  cached: true

fezcode:
  build:
    dockerfile_path: "Dockerfile.staging"
  cached: true

fpm:
  build:
    dockerfile_path: "Dockerfile"
    path: ./.docker/development/backend/fpm/
  #encrypted_env_file: ./.codeship/dockerenv.encrypted
  environment:
    APP_ENVIRONMENT: "testing"
    XDEBUG_CONFIG: "idekey=fez"
    PHP_IDE_CONFIG: "serverName=dev-fez.library.uq.edu.au"
    JAVA_HOME: "/usr/lib/jvm/jre"
    JHOVE_HOME: "/usr/local/jhove"
  links:
    - fezdb
    - fedora
    - fedoradb
  volumes_from:
    - fedoradata
    - fezcode
    - cache
  cached: true

fezdb:
  build:
    image: codeship_fezdb
    dockerfile_path: Dockerfile
    path: ./.docker/development/backend/db/
  cap_add:
    - SYS_ADMIN
  environment:
    - MYSQL_ROOT_PASSWORD=development
    - MYSQL_USER=fez
    - MYSQL_PASSWORD=fez
    - MYSQL_DATABASE=fez
  privileged: true
  volumes_from:
    - fezcode
  cached: true

fedora:
  build:
    image: codeship_fedora
    dockerfile_path: Dockerfile
    path: ./.docker/development/fedora/
  environment:
    FEDORA_HOME: "/opt/fedora"
    FEDORA_WEBAPP_HOME: "/opt/fedora/tomcat/webapps/fedora"
  links:
    - fedoradb
  ports:
    - "10083:10081"
  volumes_from:
    - fedoradata
    - cache
  cached: true

fedoradb:
  build:
    image: codeship_fedoradb
    dockerfile_path: Dockerfile
    path: ./.docker/development/backend/db/
  cap_add:
    - SYS_ADMIN
  environment:
    - MYSQL_ROOT_PASSWORD=development
    - MYSQL_USER=fedoraAdmin
    - MYSQL_PASSWORD=fedoraAdmin
    - MYSQL_DATABASE=fedora3
  privileged: true
  cached: true

cache:
  build:
    image: codeship_cache
    path: ./.docker/development/cache/
    dockerfile_path: Dockerfile
  cached: true

fezstaging:
  build:
    image: codeship_fezstaging
    dockerfile_path: Dockerfile.staging
  cached: true

awsdeployment:
  build:
    dockerfile_path: "Dockerfile.deploy"
  encrypted_env_file: "deployment.env.encrypted"
  cached: true